{"version":3,"sources":["../../../../es6/view/HostManage/RuleTable/InsertRuleModal.js"],"names":[],"mappings":"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","file":"InsertRuleModal.js","sourcesContent":["/**\n * Created by Ellery1 on 16/1/3.\n */\nimport React from 'react';\nimport {getServerByIp,validateMultiDomain} from '../../../utils';\n\nexport default React.createClass({\n    formatRuleList(ruleListStr, serverInfo, existedRuleList) {\n\n        var ruleListRaw = ruleListStr.replace(/\\#.*([\\n\\r]|$)/g,'').split(/[\\n\\r]+/),\n            ruleList = ruleListRaw.reduce((acc, ruleStr)=> {\n\n                var ruleArr = ruleStr.trim().split(/\\s+/),\n                    ip = ruleArr.shift(),\n                    domain = ruleArr.join(' ');\n\n                if (ip && domain) {\n\n                    acc.push({\n                        ip: ip,\n                        domain: domain\n                    });\n                }\n\n                return acc;\n            }, []);\n\n        var validated = validateMultiDomain(ruleList, existedRuleList);\n\n        if (!validated.result) {\n\n            alert(validated.message);\n            return null;\n        }\n\n        return ruleList.map((rule)=> {\n\n            var targetServer = getServerByIp(rule.ip, serverInfo),\n                domain = rule.domain,\n                generatedRule = {\n                    domain: domain,\n                    current: targetServer.groupName,\n                    cache: {}\n                };\n\n            generatedRule.cache[targetServer.groupName] = targetServer.ipIndex;\n\n            return generatedRule;\n        });\n    },\n    submit(){\n\n        const {onInsertRule,serverInfo,groupName,existedRuleList}=this.props;\n        var formatedRuleList = this.formatRuleList(this.refs.insertRuleInput.value, serverInfo, existedRuleList);\n\n        if (formatedRuleList) {\n            onInsertRule(groupName, formatedRuleList);\n            $(this.refs.insertRuleModal).modal('hide');\n        }\n    },\n    componentDidMount(){\n\n        $(this.refs.insertRuleModal).on('shown.bs.modal', ()=> {\n            this.refs.insertRuleInput.value = \"\";\n            this.refs.insertRuleInput.focus();\n        });\n    },\n    render(){\n\n        return (\n            <div className=\"modal\" ref=\"insertRuleModal\" id=\"addRuleMultiModal\">\n                <div className=\"modal-dialog\">\n                    <div className=\"modal-content\">\n                        <div className=\"modal-header\">\n                            <button type=\"button\" className=\"close\" data-dismiss=\"modal\" aria-label=\"Close\"><span\n                                aria-hidden=\"true\">&times;</span></button>\n                            <h4 className=\"modal-title\">批量添加规则</h4>\n                        </div>\n                        <div className=\"modal-body\">\n                            <div className=\"form-group\">\n                                <label>\n                                    格式为ip_domain, 例如127.0.0.1 localhost.可以输入多条,每行一条<br/>\n                                    新增对缩写IP的支持,例如qzz-1 qunarzz.com表示192.168.237.71 qunarzz.com<br/>\n                                    请勿使用服务器组配置中不存在的组名和服务器序号\n                                </label>\n                                <textarea\n                                    ref=\"insertRuleInput\"\n                                    type=\"text\"\n                                    className=\"form-control\"\n                                    id=\"addRuleMultiInput\">\n                                </textarea>\n                            </div>\n                        </div>\n                        <div className=\"modal-footer\">\n                            <button\n                                type=\"button\"\n                                className=\"btn btn-default\"\n                                data-dismiss=\"modal\"\n                            >\n                                取消\n                            </button>\n                            <button\n                                type=\"button\"\n                                className=\"btn btn-primary addGroupSubmit\"\n                                id=\"addRuleMultiSubmit\"\n                                onClick={this.submit}\n                            >\n                                确定\n                            </button>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        )\n    }\n});"]}