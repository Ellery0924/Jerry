{"version":3,"sources":["../es6/utils.js"],"names":[],"mappings":";;;;;QAKgB,iBAAiB,GAAjB,iBAAiB;QAYjB,cAAc,GAAd,cAAc;QA8Ed,mBAAmB,GAAnB,mBAAmB;QAqDnB,eAAe,GAAf,eAAe;QAaf,oBAAoB,GAApB,oBAAoB;QAsBpB,cAAc,GAAd,cAAc;QAsBd,aAAa,GAAb,aAAa;;;;;;;;;;;;AAxMtB,SAAS,iBAAiB,CAAC,SAAS,EAAE,SAAS,EAAE;;AAEpD,QAAI,MAAM,GAAG,SAAS,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC;QAC3C,aAAa,GAAG,WAAW,CAAC;;AAEhC,WAAO;AACH,cAAM,EAAE,MAAM;AACd,eAAO,EAAE,MAAM,GAAG,IAAI,GAAG,aAAa;KACzC,CAAC;CACL;;;AAAA,AAGM,SAAS,cAAc,CAAC,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE;;AAEpD,QAAI,aAAa,GAAG;AAChB,aAAK,EAAE,QAAQ;AACf,iBAAS,EAAE,+BAA+B;AAC1C,sBAAc,EAAE,WAAW;KAC9B,CAAC;;AAEF,QAAI,IAAI;QACJ,GAAG,GAAG;AACF,cAAM,EAAE,IAAI;KACf,CAAC;;AAEN,QAAI,CAAC,MAAM,EAAE;;AAET,eAAO;AACH,kBAAM,EAAE,KAAK;AACb,mBAAO,EAAE,aAAa,CAAC,KAAK;SAC/B,CAAC;KACL;;AAED,QAAI,YAAY;QACZ,SAAS,GAAG,WAAW;QACvB,gBAAgB,GAAG,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC;;AAE/C,SAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,gBAAgB,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;;AAE9C,YAAI,SAAS,GAAG,gBAAgB,CAAC,CAAC,CAAC,CAAC;;AAEpC,YAAI,CAAC,YAAY,CAAC,SAAS,CAAC,EAAE;;AAE1B,mBAAO;AACH,sBAAM,EAAE,KAAK;AACb,uBAAO,EAAE,SAAS,GAAG,aAAa,CAAC,cAAc;aACpD,CAAA;SACJ;KACJ;;AAED,SAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,QAAQ,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;;AAEtC,YAAI,KAAK,KAAK,SAAS,IAAI,KAAK,KAAK,SAAS,IAAI,CAAC,KAAK,KAAK,EAAE;;AAE3D,gBAAI,GAAG,QAAQ,CAAC,CAAC,CAAC,CAAC;;AAEnB,wBAAY,GAAG,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC;;AAE5C,iBAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,gBAAgB,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;;AAE9C,oBAAI,IAAI,GAAG,gBAAgB,CAAC,CAAC,CAAC,CAAC;;AAE/B,oBAAI,qBAAE,QAAQ,CAAC,YAAY,EAAE,IAAI,CAAC,EAAE;;AAEhC,2BAAO;AACH,8BAAM,EAAE,KAAK;AACb,+BAAO,EAAE,aAAa,CAAC,SAAS;qBACnC,CAAC;iBACL;aACJ;SACJ;KACJ;;AAED,WAAO,GAAG,CAAC;CACd;;AAED,SAAS,UAAU,CAAC,EAAE,EAAE;;AAEpB,QAAI,GAAG,GAAG,wDAAwD,CAAC;;AAEnE,WAAO,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;CACvB;;AAED,SAAS,YAAY,CAAC,IAAI,EAAE;;AAExB,QAAI,KAAK,GAAG,mCAAmC,CAAC;;AAEhD,WAAO,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;CAC1B;;AAEM,SAAS,mBAAmB,CAAC,QAAQ,EAAE,eAAe,EAAE;;AAE3D,QAAI,WAAW,GAAG;AACd,aAAK,EAAE,QAAQ;AACf,iBAAS,EAAE,kBAAkB;AAC7B,iBAAS,EAAE,UAAU;AACrB,oBAAY,EAAE,UAAU;KAC3B,CAAC;;AAEF,QAAI,CAAC,QAAQ,IAAI,CAAC,QAAQ,CAAC,MAAM,EAAE;;AAE/B,eAAO;AACH,kBAAM,EAAE,KAAK;AACb,mBAAO,EAAE,WAAW,CAAC,KAAK;SAC7B,CAAA;KACJ;;AAED,SAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,QAAQ,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;;AAEtC,YAAI,IAAI,GAAG,QAAQ,CAAC,CAAC,CAAC;YAClB,MAAM,GAAG,IAAI,CAAC,MAAM;YACpB,EAAE,GAAG,IAAI,CAAC,EAAE,CAAC;;AAEjB,YAAI,qBAAE,KAAK,CAAC,QAAQ,EAAE,EAAC,MAAM,EAAE,MAAM,EAAC,CAAC,CAAC,MAAM,GAAG,CAAC,EAAE;;AAEhD,mBAAO;AACH,sBAAM,EAAE,KAAK;AACb,uBAAO,EAAE,WAAW,CAAC,SAAS,GAAG,MAAM;aAC1C,CAAC;SACL;;AAED,YAAI,CAAC,cAAc,CAAC,MAAM,EAAE,CAAC,CAAC,EAAE,eAAe,CAAC,CAAC,MAAM,EAAE;;AAErD,mBAAO;AACH,sBAAM,EAAE,KAAK;AACb,uBAAO,EAAE,WAAW,CAAC,SAAS,GAAG,MAAM;aAC1C,CAAC;SACL;;AAED,YAAI,CAAC,UAAU,CAAC,EAAE,CAAC,EAAE;;AAEjB,mBAAO;AACH,sBAAM,EAAE,KAAK;AACb,uBAAO,EAAE,WAAW,CAAC,YAAY,GAAG,EAAE;aACzC,CAAA;SACJ;KACJ;;AAED,WAAO;AACH,cAAM,EAAE,IAAI;KACf,CAAC;CACL;;AAEM,SAAS,eAAe,CAAC,OAAO,EAAE,SAAS,EAAE,UAAU,EAAE;;AAE5D,QAAI,aAAa,GAAG,gBAAgB;QAChC,MAAM,GAAG,OAAO,IACZ,OAAO,CAAC,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,IAC7B,SAAS,IAAI,CAAC,qBAAE,SAAS,CAAC,UAAU,EAAE,EAAC,OAAO,EAAE,OAAO,EAAC,CAAC,CAAC;;AAElE,WAAO;AACH,cAAM,EAAE,MAAM;AACd,eAAO,EAAE,aAAa;KACzB,CAAA;CACJ;;AAEM,SAAS,oBAAoB,CAAC,YAAY,EAAE;;AAE/C,QAAI,aAAa,GAAG,iBAAiB,CAAC;;AAEtC,QAAI;;AAEA,YAAI,CAAC,KAAK,CAAC,YAAY,CAAC,CAAC;KAC5B,CACD,OAAO,CAAC,EAAE;;AAEN,eAAO;AACH,kBAAM,EAAE,KAAK;AACb,mBAAO,EAAE,aAAa;SACzB,CAAC;KACL;;AAED,WAAO;AACH,cAAM,EAAE,IAAI;AACZ,eAAO,EAAE,WAAW;KACvB,CAAC;CACL;;AAEM,SAAS,cAAc,CAAC,QAAQ,EAAE,UAAU,EAAE;;AAEjD,WAAO,QAAQ,IAAI,QAAQ,CAAC,MAAM,GAAG,QAAQ,CAAC,MAAM,CAAC,UAAU,MAAM,EAAE,IAAI,EAAE;;AAEzE,YAAI,SAAS,GAAG,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,WAAW,EAAE,GAAG,CAAC,CAAC,KAAK,CAAC,KAAK,CAAC;YAC9D,OAAO,GAAG,IAAI,CAAC,OAAO;YACtB,QAAQ,GAAG,OAAO,KAAK,QAAQ;YAC/B,KAAK,GAAG,IAAI,CAAC,KAAK;YAClB,mBAAmB,GAAG,KAAK,CAAC,OAAO,CAAC;YACpC,EAAE,GAAG,OAAO,KAAK,QAAQ,GACrB,KAAK,CAAC,MAAM,GACZ,UAAU,CAAC,OAAO,CAAC,CAAC,mBAAmB,CAAC,CAAC;;AAEjD,YAAI,CAAC,QAAQ,EAAE;;AAEX,kBAAM,GAAG,MAAM,CAAC,MAAM,CAAC,SAAS,CAAC,GAAG,CAAC,UAAA,MAAM;uBAAE,EAAE,GAAG,GAAG,GAAG,MAAM;aAAA,CAAC,CAAC,CAAC;SACpE;;AAED,eAAO,MAAM,CAAC;KACjB,EAAE,EAAE,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,EAAE,CAAC;CAC1B;;AAEM,SAAS,aAAa,CAAC,EAAE,EAAE,UAAU,EAAE;;AAE1C,QAAI,SAAS,GAAG,aAAa;QACzB,SAAS,GAAG,EAAE,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC;;AAEpC,QAAI,SAAS,IAAI,SAAS,CAAC,MAAM,EAAE;;;AAE/B,gBAAI,eAAe,GAAG,SAAS,CAAC,CAAC,CAAC;gBAC9B,aAAa,GAAG,SAAS,CAAC,CAAC,CAAC;gBAC5B,WAAW,GAAG,UAAU,CAAC,eAAe,CAAC,CAAC;;AAE9C,gBAAI,WAAW,KAAK,SAAS,EAAE;;AAE3B,oBAAI,MAAM,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,IAAI,CAAC,UAAA,WAAW;2BAAE,WAAW,KAAK,aAAa;iBAAA,CAAC,EAAE;;AAE3E;2BAAO;AACH,qCAAS,EAAE,eAAe;AAC1B,mCAAO,EAAE,aAAa;yBACzB;sBAAC;iBACL;aACJ;;;;KACJ;;AAED,QAAI,SAAS,CAAC;;AAEd,SAAK,IAAI,SAAS,IAAI,UAAU,EAAE;;AAE9B,YAAI,UAAU,CAAC,cAAc,CAAC,SAAS,CAAC,EAAE;;AAEtC,qBAAS,GAAG,UAAU,CAAC,SAAS,CAAC,CAAC;;AAElC,iBAAK,IAAI,OAAO,IAAI,SAAS,EAAE;;AAE3B,oBAAI,SAAS,CAAC,cAAc,CAAC,OAAO,CAAC,EAAE;;AAEnC,wBAAI,SAAS,CAAC,OAAO,CAAC,KAAK,EAAE,EAAE;;AAE3B,+BAAO;AACH,qCAAS,EAAE,SAAS;AACpB,mCAAO,EAAE,OAAO;yBACnB,CAAC;qBACL;iBACJ;aACJ;SACJ;KACJ;;AAED,WAAO;AACH,iBAAS,EAAE,QAAQ;AACnB,eAAO,EAAE,EAAE;KACd,CAAC;CACL","file":"utils.js","sourcesContent":["/**\n * Created by Ellery1 on 15/8/3.\n */\nimport _ from 'underscore';\n\nexport function validateGroupName(groupName, groupList) {\n\n    var result = groupName && !groupList[groupName],\n        ERROR_MESSAGE = '请输入合法的组名!';\n\n    return {\n        result: result,\n        message: result ? null : ERROR_MESSAGE\n    };\n}\n\n//验证当前新增的规则是否合法\nexport function validateDomain(domain, index, ruleList) {\n\n    var ERROR_MESSAGE = {\n        EMPTY: '域不能为空!',\n        NOT_VALID: '请输入一个合法的域!(请注意不要与当前已经定义的规则重复)',\n        NOT_VALID_HOST: '不是一个合法的域!'\n    };\n\n    var rule,\n        ret = {\n            result: true\n        };\n\n    if (!domain) {\n\n        return {\n            result: false,\n            message: ERROR_MESSAGE.EMPTY\n        };\n    }\n\n    var srcDomainArr,\n        rsplitter = /[\\s\\n\\r]+/,\n        currentDomainArr = domain.split(rsplitter);\n\n    for (let i = 0; i < currentDomainArr.length; i++) {\n\n        let subDomain = currentDomainArr[i];\n\n        if (!validateHost(subDomain)) {\n\n            return {\n                result: false,\n                message: subDomain + ERROR_MESSAGE.NOT_VALID_HOST\n            }\n        }\n    }\n\n    for (let i = 0; i < ruleList.length; i++) {\n\n        if (index === undefined || index !== undefined && i !== index) {\n\n            rule = ruleList[i];\n\n            srcDomainArr = rule.domain.split(rsplitter);\n\n            for (let j = 0; j < currentDomainArr.length; j++) {\n\n                let subD = currentDomainArr[j];\n\n                if (_.contains(srcDomainArr, subD)) {\n\n                    return {\n                        result: false,\n                        message: ERROR_MESSAGE.NOT_VALID\n                    };\n                }\n            }\n        }\n    }\n\n    return ret;\n}\n\nfunction validateIp(ip) {\n\n    var rip = /^\\s*(?:\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}|.+\\-\\d+)\\s*$/;\n\n    return rip.test(ip);\n}\n\nfunction validateHost(host) {\n\n    var rhost = /^\\s*([\\w\\d.-]+\\.[\\w]+(\\s+)?)+\\s*$/;\n\n    return rhost.test(host)\n}\n\nexport function validateMultiDomain(ruleList, existedRuleList) {\n\n    var ERR_MESSAGE = {\n        EMPTY: '请输入规则!',\n        REDUNDANT: '当前输入规则中存在重复的规则: ',\n        NOT_VALID: '存在非法的域: ',\n        NOT_VALID_IP: '存在非法的IP:'\n    };\n\n    if (!ruleList || !ruleList.length) {\n\n        return {\n            result: false,\n            message: ERR_MESSAGE.EMPTY\n        }\n    }\n\n    for (var i = 0; i < ruleList.length; i++) {\n\n        var rule = ruleList[i],\n            domain = rule.domain,\n            ip = rule.ip;\n\n        if (_.where(ruleList, {domain: domain}).length > 1) {\n\n            return {\n                result: false,\n                message: ERR_MESSAGE.REDUNDANT + domain\n            };\n        }\n\n        if (!validateDomain(domain, -1, existedRuleList).result) {\n\n            return {\n                result: false,\n                message: ERR_MESSAGE.NOT_VALID + domain\n            };\n        }\n\n        if (!validateIp(ip)) {\n\n            return {\n                result: false,\n                message: ERR_MESSAGE.NOT_VALID_IP + ip\n            }\n        }\n    }\n\n    return {\n        result: true\n    };\n}\n\nexport function validatePattern(pattern, responder, patterList) {\n\n    var ERROR_MESSAGE = \"Pattern非法,请检查.\",\n        result = pattern &&\n            pattern.search(/\\s+/g) === -1 &&\n            responder && !_.findWhere(patterList, {pattern: pattern});\n\n    return {\n        result: result,\n        message: ERROR_MESSAGE\n    }\n}\n\nexport function validateServerConfig(serverConfig) {\n\n    var ERROR_MESSAGE = \"非法的JSON字符串,请检查.\";\n\n    try {\n\n        JSON.parse(serverConfig);\n    }\n    catch (e) {\n\n        return {\n            result: false,\n            message: ERROR_MESSAGE\n        };\n    }\n\n    return {\n        result: true,\n        message: '服务器配置已更新!'\n    };\n}\n\nexport function exportHostList(ruleList, serverInfo) {\n\n    return ruleList && ruleList.length ? ruleList.reduce(function (result, rule) {\n\n        var domainArr = rule.domain.replace(/[\\n\\r\\s]+/, ' ').split(/\\s+/),\n            current = rule.current,\n            isOnline = current === 'online',\n            cache = rule.cache,\n            selectedServerIndex = cache[current],\n            ip = current === 'custom' ?\n                cache.custom :\n                serverInfo[current][selectedServerIndex];\n\n        if (!isOnline) {\n\n            result = result.concat(domainArr.map(domain=>ip + ' ' + domain));\n        }\n\n        return result;\n    }, []).join('\\n') : '';\n}\n\nexport function getServerByIp(ip, serverInfo) {\n\n    var rshortcut = /(.+)\\-(\\d+)/,\n        mshortcut = ip.match(rshortcut);\n\n    if (mshortcut && mshortcut.length) {\n\n        let insertGroupName = mshortcut[1],\n            insertIpIndex = mshortcut[2],\n            targetGroup = serverInfo[insertGroupName];\n\n        if (targetGroup !== undefined) {\n\n            if (Object.keys(targetGroup).some(serverIndex=>serverIndex === insertIpIndex)) {\n\n                return {\n                    groupName: insertGroupName,\n                    ipIndex: insertIpIndex\n                };\n            }\n        }\n    }\n\n    var groupInfo;\n\n    for (let groupName in serverInfo) {\n\n        if (serverInfo.hasOwnProperty(groupName)) {\n\n            groupInfo = serverInfo[groupName];\n\n            for (let ipIndex in groupInfo) {\n\n                if (groupInfo.hasOwnProperty(ipIndex)) {\n\n                    if (groupInfo[ipIndex] === ip) {\n\n                        return {\n                            groupName: groupName,\n                            ipIndex: ipIndex\n                        };\n                    }\n                }\n            }\n        }\n    }\n\n    return {\n        groupName: 'custom',\n        ipIndex: ip\n    };\n}"]}